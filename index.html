<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Star Tracker">
  <title>Kids Star Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Nunito', sans-serif;
      overflow-x: hidden;
    }
    
    .star-pop {
      animation: starPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    @keyframes starPop {
      0% {
        transform: scale(0) rotate(0deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.3) rotate(180deg);
      }
      100% {
        transform: scale(1) rotate(360deg);
        opacity: 1;
      }
    }
    
    .sparkle {
      animation: sparkle 1.5s ease-in-out infinite;
    }
    
    @keyframes sparkle {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.5;
        transform: scale(0.8);
      }
    }
    
    .slide-up {
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #ffd700;
      animation: confettiFall 3s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }
    
    @keyframes confettiFall {
      to {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    .kid-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }
    
    .kid-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }
    
    .calendar-day {
      transition: all 0.2s ease;
    }
    
    .calendar-day:hover {
      transform: scale(1.1);
      z-index: 10;
    }
    
    .category-chip {
      transition: all 0.2s ease;
    }
    
    .category-chip:hover {
      transform: scale(1.05);
    }
    
    .category-chip:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    // ‚ö†Ô∏è PASTE YOUR FIREBASE CONFIG HERE
    const firebaseConfig = {
        apiKey: "AIzaSyDLxCEmP3RchhEwjRULu0ELMg_iLItBfkw",
  authDomain: "class-tracker-7ec05.firebaseapp.com",
  databaseURL: "https://class-tracker-7ec05-default-rtdb.firebaseio.com",
  projectId: "class-tracker-7ec05",
  storageBucket: "class-tracker-7ec05.firebasestorage.app",
  messagingSenderId: "34124797425",
  appId: "1:34124797425:web:9d92e45482eb27cff6e050"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
  </script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Default categories
    const DEFAULT_CATEGORIES = [
      { id: 'homework', name: 'Homework', color: '#FF6B9D', emoji: 'üìö', forKid: 'all' },
      { id: 'room-cleanup', name: 'Room Cleanup', color: '#4ECDC4', emoji: 'üßπ', forKid: 'all' },
      { id: 'table-manners', name: 'Table Manners', color: '#FFE66D', emoji: 'üçΩÔ∏è', forKid: 'all' },
      { id: 'speak-kindly', name: 'Speak Kindly', color: '#A8DADC', emoji: 'üí¨', forKid: 'all' },
      { id: 'sibling-kindness', name: 'Kind to Sibling', color: '#F4A261', emoji: 'ü§ù', forKid: 'all' },
      { id: 'school-behavior', name: 'School Behavior', color: '#95E1D3', emoji: 'üéí', forKid: 'all' },
      { id: 'reading', name: 'Reading', color: '#C7CEEA', emoji: 'üìñ', forKid: 'all' },
      { id: 'no-candy', name: 'No Candy Today', color: '#FFA8B8', emoji: 'üö´üç¨', forKid: 'all' },
      { id: 'practice-violin', name: 'Practice Violin', color: '#DDA5E8', emoji: 'üéª', forKid: 'kid1' },
      { id: 'practice-piano', name: 'Practice Piano', color: '#89CFF0', emoji: 'üéπ', forKid: 'kid2' },
      { id: 'online-courses', name: 'Online Class Behavior', color: '#B4E7CE', emoji: 'üíª', forKid: 'kid2' }
    ];

    // Icon Components
    const Star = ({ className, filled = false }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" className={className} fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2">
        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
      </svg>
    );

    const HalfStar = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" className={className}>
        <defs>
          <linearGradient id="half-star">
            <stop offset="50%" stopColor="currentColor" />
            <stop offset="50%" stopColor="transparent" />
          </linearGradient>
        </defs>
        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" fill="url(#half-star)" stroke="currentColor" strokeWidth="2"/>
      </svg>
    );

    const Plus = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    );

    const X = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );

    const Trash = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
      </svg>
    );

    const ChevronLeft = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" className={className}>
        <polyline points="15 18 9 12 15 6"/>
      </svg>
    );

    const ChevronRight = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" className={className}>
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    );

    const Settings = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.2-13.2l-1.4 1.4M6.8 14.8l-1.4 1.4m9.2 1.4l-1.4-1.4M6.8 9.2L5.4 7.8m12.6 7l-6-2m-6-2l-6 2"/>
      </svg>
    );

    const Gift = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
      </svg>
    );

    const Award = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
      </svg>
    );

    // Confetti effect
    function createConfetti() {
      const colors = ['#FFD700', '#FF6B9D', '#4ECDC4', '#FFE66D', '#F4A261', '#A8DADC'];
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 3000);
        }, i * 50);
      }
    }

    function LoginScreen() {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);

      const handleLogin = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
          await firebase.auth().signInWithEmailAndPassword(email, password);
        } catch (error) {
          setError(error.message);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="min-h-screen flex items-center justify-center p-4" style={{
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
        }}>
          <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
            <div className="text-center mb-8">
              <div className="text-6xl mb-4">‚≠ê</div>
              <h1 className="text-4xl font-bold mb-2" style={{ fontFamily: "'Fredoka', sans-serif", color: '#667eea' }}>
                Star Tracker
              </h1>
              <p className="text-gray-600 text-lg">Track your kids' achievements!</p>
            </div>

            <form onSubmit={handleLogin} className="space-y-4">
              <div>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-2xl focus:border-purple-500 focus:outline-none text-lg"
                  placeholder="Email"
                  required
                />
              </div>

              <div>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-2xl focus:border-purple-500 focus:outline-none text-lg"
                  placeholder="Password"
                  required
                />
              </div>

              {error && (
                <div className="bg-red-50 border-2 border-red-200 text-red-700 px-4 py-3 rounded-2xl text-sm">
                  {error}
                </div>
              )}

              <button
                type="submit"
                disabled={loading}
                className="w-full py-3 rounded-2xl font-bold text-white text-lg transition-all disabled:opacity-50"
                style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}
              >
                {loading ? 'Signing in...' : 'Sign In'}
              </button>
            </form>
          </div>
        </div>
      );
    }

    function StarTracker({ user, onLogout }) {
      const [kids, setKids] = useState([
        { id: 'kid1', name: 'Kid 1', color: '#FF6B9D', avatar: 'üëß' },
        { id: 'kid2', name: 'Kid 2', color: '#4ECDC4', avatar: 'üë¶' }
      ]);
      const [selectedKid, setSelectedKid] = useState(null);
      const [stars, setStars] = useState({}); // { kid1: { '2026-02-15': { homework: true, chores: true } } }
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const [selectedDate, setSelectedDate] = useState(null);
      const [showCategoryModal, setShowCategoryModal] = useState(false);
      const [categories, setCategories] = useState(DEFAULT_CATEGORIES);
      const [newCategoryName, setNewCategoryName] = useState('');
      const [newCategoryForKid, setNewCategoryForKid] = useState('all'); // 'all', 'kid1', or 'kid2'
      const [isLoading, setIsLoading] = useState(true);
      const [showEditKidModal, setShowEditKidModal] = useState(false);
      const [editingKid, setEditingKid] = useState(null);
      const [editKidName, setEditKidName] = useState('');
      const [editKidAvatar, setEditKidAvatar] = useState('');
      const [showRewardsModal, setShowRewardsModal] = useState(false);
      const [showRedemptionModal, setShowRedemptionModal] = useState(false);
      const [starsPerCertificate, setStarsPerCertificate] = useState(50);
      const [starsPerDiamond, setStarsPerDiamond] = useState(100);
      const [rewards, setRewards] = useState({}); // { kid1: { certificates: 2, diamonds: 1 } }
      const [showManageCategoriesModal, setShowManageCategoriesModal] = useState(false);
      const [categorySettings, setCategorySettings] = useState({}); // { kid1: { homework: true, chores: false }, kid2: { ... } }

      const dataRef = firebase.database().ref(`users/${user.uid}/starTracker`);

      useEffect(() => {
        const listener = dataRef.on('value', (snapshot) => {
          const data = snapshot.val();
          if (data) {
            if (data.kids) setKids(data.kids);
            if (data.stars) setStars(data.stars);
            
            // Always include default categories, plus any custom ones from Firebase
            if (data.categories) {
              const customCategories = data.categories.filter(
                cat => !DEFAULT_CATEGORIES.some(def => def.id === cat.id)
              );
              setCategories([...DEFAULT_CATEGORIES, ...customCategories]);
            } else {
              setCategories(DEFAULT_CATEGORIES);
            }
            
            if (data.rewards) setRewards(data.rewards);
            if (data.starsPerCertificate) setStarsPerCertificate(data.starsPerCertificate);
            if (data.starsPerDiamond) setStarsPerDiamond(data.starsPerDiamond);
            if (data.categorySettings) setCategorySettings(data.categorySettings);
          }
          setIsLoading(false);
        }, (error) => {
          console.error('Firebase read error:', error);
          setIsLoading(false);
        });

        return () => dataRef.off('value', listener);
      }, []);

      useEffect(() => {
        if (!isLoading) {
          saveToFirebase();
        }
      }, [kids, stars, categories, rewards, starsPerCertificate, starsPerDiamond, categorySettings]);

      const saveToFirebase = async () => {
        try {
          // Only save custom categories (not default ones)
          const customCategories = categories.filter(
            cat => !DEFAULT_CATEGORIES.some(def => def.id === cat.id)
          );
          
          await dataRef.set({
            kids,
            stars,
            categories: customCategories,
            rewards,
            starsPerCertificate,
            starsPerDiamond,
            categorySettings,
            lastModified: new Date().toISOString()
          });
        } catch (error) {
          console.error('Error saving:', error);
        }
      };

      const toggleStar = (kidId, date, categoryId) => {
        const newStars = { ...stars };
        if (!newStars[kidId]) newStars[kidId] = {};
        if (!newStars[kidId][date]) newStars[kidId][date] = {};
        
        const currentValue = newStars[kidId][date][categoryId];
        
        // Cycle: undefined/false ‚Üí 0.5 ‚Üí 1 ‚Üí undefined/false
        if (!currentValue) {
          newStars[kidId][date][categoryId] = 0.5;
        } else if (currentValue === 0.5) {
          newStars[kidId][date][categoryId] = 1;
          createConfetti();
        } else {
          newStars[kidId][date][categoryId] = false;
        }
        
        setStars(newStars);
      };

      const addCustomCategory = () => {
        if (!newCategoryName.trim()) return;
        
        const colors = ['#FF6B9D', '#4ECDC4', '#FFE66D', '#A8DADC', '#F4A261', '#95E1D3', '#C7CEEA', '#FFA8B8', '#DDA5E8', '#89CFF0', '#B4E7CE'];
        const emojis = ['üé®', '‚öΩ', 'üéµ', 'üéØ', 'üèÜ', 'üåü', 'üí™', 'üéâ', 'üéÆ', 'üßò', 'üé≠', 'üèÉ', 'üé∏', 'ü•ã', 'üé™'];
        
        const newCategory = {
          id: `custom_${Date.now()}`,
          name: newCategoryName,
          color: colors[Math.floor(Math.random() * colors.length)],
          emoji: emojis[Math.floor(Math.random() * emojis.length)],
          forKid: newCategoryForKid
        };
        
        setCategories([...categories, newCategory]);
        setNewCategoryName('');
        setNewCategoryForKid('all');
      };

      const deleteCategory = (categoryId) => {
        // Check if it's a built-in default category
        if (DEFAULT_CATEGORIES.some(c => c.id === categoryId)) {
          alert("Can't delete built-in categories! Use 'Manage Categories' to disable them instead.");
          return;
        }
        // Delete custom category
        setCategories(categories.filter(c => c.id !== categoryId));
      };

      const saveKidEdit = () => {
        if (!editKidName.trim()) return;
        
        const updatedKids = kids.map(k => 
          k.id === editingKid.id 
            ? { ...k, name: editKidName, avatar: editKidAvatar }
            : k
        );
        
        setKids(updatedKids);
        setShowEditKidModal(false);
        setEditingKid(null);
        setEditKidName('');
        setEditKidAvatar('');
      };

      const openEditKidModal = (kid) => {
        setEditingKid(kid);
        setEditKidName(kid.name);
        setEditKidAvatar(kid.avatar);
        setShowEditKidModal(true);
      };

      const isCategoryEnabledForKid = (categoryId, kidId) => {
        // If no settings exist, all default categories are enabled by default
        if (!categorySettings[kidId]) return true;
        // If setting exists, use it; otherwise default to true
        return categorySettings[kidId][categoryId] !== false;
      };

      const toggleCategoryForKid = (categoryId, kidId) => {
        const newSettings = { ...categorySettings };
        if (!newSettings[kidId]) newSettings[kidId] = {};
        
        // Toggle the setting
        newSettings[kidId][categoryId] = !isCategoryEnabledForKid(categoryId, kidId);
        
        setCategorySettings(newSettings);
      };

      const redeemReward = (kidId, rewardType) => {
        const stats = getStarsForKid(kidId);
        const cost = rewardType === 'certificate' ? starsPerCertificate : starsPerDiamond;
        
        if (stats.total < cost) {
          alert(`Not enough stars! Need ${cost} stars, but only have ${stats.total.toFixed(1)} stars.`);
          return;
        }

        // Deduct stars from the most recent dates first
        const newStars = { ...stars };
        if (!newStars[kidId]) return;
        
        let starsToDeduct = cost;
        const dates = Object.keys(newStars[kidId]).sort().reverse(); // Most recent first
        
        for (const date of dates) {
          if (starsToDeduct <= 0) break;
          
          const categories = Object.keys(newStars[kidId][date]);
          for (const category of categories) {
            if (starsToDeduct <= 0) break;
            
            const currentValue = newStars[kidId][date][category];
            if (currentValue) {
              const starValue = currentValue === 0.5 ? 0.5 : 1;
              
              if (starsToDeduct >= starValue) {
                // Remove the entire star
                newStars[kidId][date][category] = false;
                starsToDeduct -= starValue;
              } else {
                // Convert full star to half star if we only need 0.5 more
                if (currentValue === 1 && starsToDeduct === 0.5) {
                  newStars[kidId][date][category] = 0.5;
                  starsToDeduct = 0;
                }
              }
            }
          }
        }
        
        // Add reward
        const newRewards = { ...rewards };
        if (!newRewards[kidId]) {
          newRewards[kidId] = { certificates: 0, diamonds: 0 };
        }
        
        if (rewardType === 'certificate') {
          newRewards[kidId].certificates = (newRewards[kidId].certificates || 0) + 1;
        } else {
          newRewards[kidId].diamonds = (newRewards[kidId].diamonds || 0) + 1;
        }
        
        setStars(newStars);
        setRewards(newRewards);
        createConfetti();
        alert(`üéâ Redeemed 1 ${rewardType}!`);
      };

      const getStarsForKid = (kidId) => {
        if (!stars[kidId]) return { total: 0, today: 0, thisWeek: 0 };
        
        const today = new Date().toISOString().split('T')[0];
        const startOfWeek = new Date();
        startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
        const weekStart = startOfWeek.toISOString().split('T')[0];
        
        let total = 0;
        let todayCount = 0;
        let thisWeekCount = 0;
        
        Object.entries(stars[kidId]).forEach(([date, cats]) => {
          const count = Object.values(cats).reduce((sum, val) => {
            if (val === 0.5) return sum + 0.5;
            if (val === 1 || val === true) return sum + 1;
            return sum;
          }, 0);
          
          total += count;
          if (date === today) todayCount += count;
          if (date >= weekStart) thisWeekCount += count;
        });
        
        return { total, today: todayCount, thisWeek: thisWeekCount };
      };

      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        return { daysInMonth, startingDayOfWeek, year, month };
      };

      const { daysInMonth, startingDayOfWeek, year, month } = getDaysInMonth(currentMonth);
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

      const getStarsForDate = (kidId, date) => {
        if (!stars[kidId] || !stars[kidId][date]) return 0;
        return Object.values(stars[kidId][date]).reduce((sum, val) => {
          if (val === 0.5) return sum + 0.5;
          if (val === 1 || val === true) return sum + 1;
          return sum;
        }, 0);
      };

      if (isLoading) {
        return (
          <div className="min-h-screen flex items-center justify-center" style={{
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
          }}>
            <div className="text-white text-2xl font-bold">Loading...</div>
          </div>
        );
      }

      if (!selectedKid) {
        return (
          <div className="min-h-screen p-6" style={{
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
          }}>
            <div className="max-w-4xl mx-auto">
              <div className="text-center mb-12">
                <h1 className="text-6xl font-bold text-white mb-4" style={{ fontFamily: "'Fredoka', sans-serif" }}>
                  ‚≠ê Star Tracker
                </h1>
                <p className="text-white text-xl opacity-90">Choose a kid to track stars</p>
                
                <button
                  onClick={() => setShowRewardsModal(true)}
                  className="mt-4 px-6 py-3 bg-white rounded-2xl font-semibold text-purple-600 hover:bg-gray-100 transition-all flex items-center gap-2 mx-auto shadow-lg"
                >
                  <Settings className="w-5 h-5" />
                  Rewards Settings
                </button>
              </div>

              <div className="grid md:grid-cols-2 gap-8">
                {kids.map(kid => {
                  const stats = getStarsForKid(kid.id);
                  return (
                    <div
                      key={kid.id}
                      className="kid-card bg-white rounded-3xl p-8 shadow-2xl relative"
                    >
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          openEditKidModal(kid);
                        }}
                        className="absolute top-4 right-4 p-2 bg-gray-100 hover:bg-gray-200 rounded-xl transition-colors"
                      >
                        <Settings className="w-5 h-5 text-gray-600" />
                      </button>
                      
                      <div className="text-center" onClick={() => setSelectedKid(kid)} style={{ cursor: 'pointer' }}>
                        <div className="text-8xl mb-4">{kid.avatar}</div>
                        <h2 className="text-4xl font-bold mb-6" style={{ 
                          fontFamily: "'Fredoka', sans-serif",
                          color: kid.color 
                        }}>
                          {kid.name}
                        </h2>
                        
                        <div className="space-y-4">
                          <div className="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-4">
                            <div className="text-gray-600 text-sm font-semibold mb-1">Total Stars</div>
                            <div className="text-4xl font-bold flex items-center justify-center gap-2" style={{ color: kid.color }}>
                              <Star className="w-10 h-10" filled />
                              {stats.total % 1 === 0 ? stats.total : stats.total.toFixed(1)}
                            </div>
                          </div>
                          
                          <div className="grid grid-cols-2 gap-4">
                            <div className="bg-blue-50 rounded-2xl p-4">
                              <div className="text-gray-600 text-xs font-semibold mb-1">Today</div>
                              <div className="text-2xl font-bold text-blue-600">
                                {stats.today % 1 === 0 ? stats.today : stats.today.toFixed(1)}
                              </div>
                            </div>
                            <div className="bg-purple-50 rounded-2xl p-4">
                              <div className="text-gray-600 text-xs font-semibold mb-1">This Week</div>
                              <div className="text-2xl font-bold text-purple-600">
                                {stats.thisWeek % 1 === 0 ? stats.thisWeek : stats.thisWeek.toFixed(1)}
                              </div>
                            </div>
                          </div>

                          <div className="grid grid-cols-2 gap-4 pt-2">
                            <div className="bg-green-50 rounded-2xl p-3 border-2 border-green-200">
                              <div className="text-green-700 text-xs font-semibold mb-1">üìú Certificates</div>
                              <div className="text-3xl font-bold text-green-600">
                                {rewards[kid.id]?.certificates || 0}
                              </div>
                            </div>
                            <div className="bg-pink-50 rounded-2xl p-3 border-2 border-pink-200">
                              <div className="text-pink-700 text-xs font-semibold mb-1">üíé Diamonds</div>
                              <div className="text-3xl font-bold text-pink-600">
                                {rewards[kid.id]?.diamonds || 0}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen p-4 md:p-6" style={{
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
        }}>
          <div className="max-w-6xl mx-auto">
            {/* Header */}
            <div className="bg-white rounded-3xl shadow-2xl p-6 mb-6">
              <div className="flex items-center justify-between mb-6">
                <button
                  onClick={() => setSelectedKid(null)}
                  className="text-gray-600 hover:text-gray-800 font-semibold flex items-center gap-2"
                >
                  <ChevronLeft className="w-6 h-6" />
                  Back
                </button>
                
                <div className="text-center flex-1">
                  <div className="text-5xl mb-2">{selectedKid.avatar}</div>
                  <h2 className="text-3xl font-bold" style={{ 
                    fontFamily: "'Fredoka', sans-serif",
                    color: selectedKid.color 
                  }}>
                    {selectedKid.name}
                  </h2>
                </div>
                
                <button
                  onClick={() => setShowManageCategoriesModal(true)}
                  className="p-2 hover:bg-gray-100 rounded-xl transition-colors"
                  title="Manage Categories"
                >
                  <Settings className="w-6 h-6 text-gray-600" />
                </button>
              </div>

              {/* Stats */}
              <div className="grid grid-cols-3 gap-4 mb-4">
                {(() => {
                  const stats = getStarsForKid(selectedKid.id);
                  return (
                    <>
                      <div className="bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl p-4 text-center">
                        <div className="text-sm font-semibold text-gray-700 mb-1">Total</div>
                        <div className="text-4xl font-bold flex items-center justify-center gap-1" style={{ color: selectedKid.color }}>
                          <Star className="w-8 h-8" filled />
                          {stats.total % 1 === 0 ? stats.total : stats.total.toFixed(1)}
                        </div>
                      </div>
                      <div className="bg-blue-100 rounded-2xl p-4 text-center">
                        <div className="text-sm font-semibold text-gray-700 mb-1">Today</div>
                        <div className="text-4xl font-bold text-blue-600">
                          {stats.today % 1 === 0 ? stats.today : stats.today.toFixed(1)}
                        </div>
                      </div>
                      <div className="bg-purple-100 rounded-2xl p-4 text-center">
                        <div className="text-sm font-semibold text-gray-700 mb-1">This Week</div>
                        <div className="text-4xl font-bold text-purple-600">
                          {stats.thisWeek % 1 === 0 ? stats.thisWeek : stats.thisWeek.toFixed(1)}
                        </div>
                      </div>
                    </>
                  );
                })()}
              </div>

              {/* Rewards Display */}
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-4 border-2 border-green-200">
                  <div className="flex items-center justify-between">
                    <div>
                      <div className="text-green-700 text-sm font-semibold mb-1">üìú Certificates</div>
                      <div className="text-3xl font-bold text-green-600">
                        {rewards[selectedKid.id]?.certificates || 0}
                      </div>
                    </div>
                  </div>
                </div>
                <div className="bg-gradient-to-r from-pink-50 to-rose-50 rounded-2xl p-4 border-2 border-pink-200">
                  <div className="flex items-center justify-between">
                    <div>
                      <div className="text-pink-700 text-sm font-semibold mb-1">üíé Diamonds</div>
                      <div className="text-3xl font-bold text-pink-600">
                        {rewards[selectedKid.id]?.diamonds || 0}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <button
                onClick={() => setShowRedemptionModal(true)}
                className="w-full mt-4 py-3 rounded-2xl font-bold text-white transition-all hover:scale-105 flex items-center justify-center gap-2"
                style={{ background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' }}
              >
                <Gift className="w-6 h-6" />
                Redeem Stars for Rewards
              </button>
            </div>

            {/* Calendar */}
            <div className="bg-white rounded-3xl shadow-2xl p-6">
              <div className="flex items-center justify-between mb-6">
                <button
                  onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))}
                  className="p-3 rounded-2xl hover:bg-gray-100 transition-colors"
                >
                  <ChevronLeft className="w-6 h-6" style={{ color: selectedKid.color }} />
                </button>
                
                <h3 className="text-2xl font-bold" style={{ 
                  fontFamily: "'Fredoka', sans-serif",
                  color: selectedKid.color 
                }}>
                  {monthNames[month]} {year}
                </h3>
                
                <button
                  onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1))}
                  className="p-3 rounded-2xl hover:bg-gray-100 transition-colors"
                >
                  <ChevronRight className="w-6 h-6" style={{ color: selectedKid.color }} />
                </button>
              </div>

              <div className="grid grid-cols-7 gap-2">
                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                  <div key={day} className="text-center font-bold text-gray-600 text-sm py-2">
                    {day}
                  </div>
                ))}

                {[...Array(startingDayOfWeek)].map((_, i) => (
                  <div key={`empty-${i}`} />
                ))}

                {[...Array(daysInMonth)].map((_, i) => {
                  const day = i + 1;
                  const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                  const starCount = getStarsForDate(selectedKid.id, dateStr);
                  const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();

                  return (
                    <button
                      key={day}
                      onClick={() => {
                        setSelectedDate(dateStr);
                        setShowCategoryModal(true);
                      }}
                      className="calendar-day aspect-square rounded-2xl flex flex-col items-center justify-center font-bold text-lg relative"
                      style={{
                        background: starCount > 0 
                          ? `linear-gradient(135deg, ${selectedKid.color}20, ${selectedKid.color}40)`
                          : '#f8f9fa',
                        border: isToday ? `3px solid ${selectedKid.color}` : 'none'
                      }}
                    >
                      <span className="text-gray-800">{day}</span>
                      {starCount > 0 && (
                        <div className="flex items-center gap-1 mt-1">
                          <Star className="w-4 h-4 sparkle" style={{ color: selectedKid.color }} filled />
                          <span className="text-xs font-bold" style={{ color: selectedKid.color }}>
                            {starCount % 1 === 0 ? starCount : starCount.toFixed(1)}
                          </span>
                        </div>
                      )}
                    </button>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Category Modal */}
          {showCategoryModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-3xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto slide-up">
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-2xl font-bold" style={{ 
                    fontFamily: "'Fredoka', sans-serif",
                    color: selectedKid.color 
                  }}>
                    {selectedDate}
                  </h3>
                  <button
                    onClick={() => setShowCategoryModal(false)}
                    className="p-2 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <X className="w-6 h-6 text-gray-600" />
                  </button>
                </div>

                <div className="grid grid-cols-2 gap-4 mb-6">
                  {categories
                    .filter(cat => {
                      // Check if category is meant for this kid or all kids
                      const isForThisKid = cat.forKid === 'all' || cat.forKid === selectedKid.id;
                      if (!isForThisKid) return false;
                      
                      // Check if it's a default category and if it's enabled for this kid
                      const isDefaultCategory = DEFAULT_CATEGORIES.some(def => def.id === cat.id);
                      if (isDefaultCategory) {
                        return isCategoryEnabledForKid(cat.id, selectedKid.id);
                      }
                      
                      // Custom categories are always shown
                      return true;
                    })
                    .map(category => {
                    const earned = stars[selectedKid.id]?.[selectedDate]?.[category.id];
                    
                    return (
                      <button
                        key={category.id}
                        onClick={() => toggleStar(selectedKid.id, selectedDate, category.id)}
                        className="category-chip relative p-6 rounded-2xl text-left font-semibold text-lg shadow-lg"
                        style={{
                          background: earned 
                            ? `linear-gradient(135deg, ${category.color}, ${category.color}dd)`
                            : '#f8f9fa',
                          color: earned ? 'white' : '#333'
                        }}
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className="text-3xl mb-2">{category.emoji}</div>
                            <div>{category.name}</div>
                          </div>
                          {earned === 0.5 && (
                            <HalfStar className="w-10 h-10 text-white star-pop" />
                          )}
                          {(earned === 1 || earned === true) && (
                            <Star className="w-10 h-10 text-white star-pop" filled />
                          )}
                        </div>
                        
                        {!DEFAULT_CATEGORIES.some(c => c.id === category.id) && (
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              deleteCategory(category.id);
                            }}
                            className="absolute top-2 right-2 p-2 bg-red-500 rounded-xl hover:bg-red-600 transition-colors"
                          >
                            <Trash className="w-4 h-4 text-white" />
                          </button>
                        )}
                      </button>
                    );
                  })}
                </div>

                {/* Add Custom Category */}
                <div className="border-t-2 border-gray-200 pt-6">
                  <h4 className="font-bold text-lg mb-4 text-gray-700">Add Custom Category</h4>
                  
                  <div className="mb-3">
                    <label className="block text-sm font-semibold text-gray-600 mb-2">
                      Category Name
                    </label>
                    <input
                      type="text"
                      value={newCategoryName}
                      onChange={(e) => setNewCategoryName(e.target.value)}
                      placeholder="e.g., Swimming Practice"
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-2xl focus:border-purple-500 focus:outline-none"
                      onKeyPress={(e) => e.key === 'Enter' && addCustomCategory()}
                    />
                  </div>

                  <div className="mb-4">
                    <label className="block text-sm font-semibold text-gray-600 mb-2">
                      Available For
                    </label>
                    <div className="grid grid-cols-3 gap-2">
                      <button
                        onClick={() => setNewCategoryForKid('all')}
                        className={`py-3 px-4 rounded-xl font-semibold transition-all ${
                          newCategoryForKid === 'all'
                            ? 'bg-purple-500 text-white shadow-lg scale-105'
                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                      >
                        Both Kids
                      </button>
                      <button
                        onClick={() => setNewCategoryForKid('kid1')}
                        className={`py-3 px-4 rounded-xl font-semibold transition-all ${
                          newCategoryForKid === 'kid1'
                            ? 'bg-purple-500 text-white shadow-lg scale-105'
                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                      >
                        {kids[0]?.name || 'Kid 1'}
                      </button>
                      <button
                        onClick={() => setNewCategoryForKid('kid2')}
                        className={`py-3 px-4 rounded-xl font-semibold transition-all ${
                          newCategoryForKid === 'kid2'
                            ? 'bg-purple-500 text-white shadow-lg scale-105'
                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                      >
                        {kids[1]?.name || 'Kid 2'}
                      </button>
                    </div>
                  </div>

                  <button
                    onClick={addCustomCategory}
                    className="w-full px-6 py-3 rounded-2xl text-white font-semibold flex items-center justify-center gap-2 transition-all hover:scale-105"
                    style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}
                  >
                    <Plus className="w-5 h-5" />
                    Add Category
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Rewards Settings Modal */}
          {showRewardsModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-3xl p-6 max-w-md w-full slide-up">
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-2xl font-bold text-purple-600" style={{ fontFamily: "'Fredoka', sans-serif" }}>
                    ‚öôÔ∏è Rewards Settings
                  </h3>
                  <button
                    onClick={() => setShowRewardsModal(false)}
                    className="p-2 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <X className="w-6 h-6 text-gray-600" />
                  </button>
                </div>

                <div className="space-y-6">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      üìú Stars needed for 1 Certificate
                    </label>
                    <input
                      type="number"
                      value={starsPerCertificate}
                      onChange={(e) => setStarsPerCertificate(parseInt(e.target.value) || 0)}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-2xl focus:border-green-500 focus:outline-none text-lg font-bold text-center"
                      min="1"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      üíé Stars needed for 1 Diamond
                    </label>
                    <input
                      type="number"
                      value={starsPerDiamond}
                      onChange={(e) => setStarsPerDiamond(parseInt(e.target.value) || 0)}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-2xl focus:border-pink-500 focus:outline-none text-lg font-bold text-center"
                      min="1"
                    />
                  </div>

                  <button
                    onClick={() => setShowRewardsModal(false)}
                    className="w-full py-3 rounded-2xl text-white font-bold text-lg transition-all hover:scale-105"
                    style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}
                  >
                    Save Settings
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Redemption Modal */}
          {showRedemptionModal && selectedKid && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-3xl p-6 max-w-md w-full slide-up">
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-2xl font-bold" style={{ 
                    fontFamily: "'Fredoka', sans-serif",
                    color: selectedKid.color 
                  }}>
                    üéÅ Redeem Rewards
                  </h3>
                  <button
                    onClick={() => setShowRedemptionModal(false)}
                    className="p-2 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <X className="w-6 h-6 text-gray-600" />
                  </button>
                </div>

                <div className="mb-6 bg-yellow-50 rounded-2xl p-4 border-2 border-yellow-200">
                  <div className="text-center">
                    <div className="text-gray-600 text-sm font-semibold mb-1">Available Stars</div>
                    <div className="text-5xl font-bold flex items-center justify-center gap-2" style={{ color: selectedKid.color }}>
                      <Star className="w-12 h-12" filled />
                      {(() => {
                        const total = getStarsForKid(selectedKid.id).total;
                        return total % 1 === 0 ? total : total.toFixed(1);
                      })()}
                    </div>
                  </div>
                </div>

                <div className="space-y-4">
                  <button
                    onClick={() => {
                      redeemReward(selectedKid.id, 'certificate');
                      setShowRedemptionModal(false);
                    }}
                    className="w-full p-6 rounded-2xl bg-gradient-to-r from-green-100 to-emerald-100 border-2 border-green-300 hover:border-green-400 transition-all hover:scale-105"
                  >
                    <div className="flex items-center justify-between">
                      <div className="text-left">
                        <div className="text-3xl mb-2">üìú</div>
                        <div className="font-bold text-xl text-green-700">Certificate</div>
                        <div className="text-sm text-gray-600">
                          Cost: {starsPerCertificate} ‚≠ê
                        </div>
                      </div>
                      <Award className="w-12 h-12 text-green-600" />
                    </div>
                  </button>

                  <button
                    onClick={() => {
                      redeemReward(selectedKid.id, 'diamond');
                      setShowRedemptionModal(false);
                    }}
                    className="w-full p-6 rounded-2xl bg-gradient-to-r from-pink-100 to-rose-100 border-2 border-pink-300 hover:border-pink-400 transition-all hover:scale-105"
                  >
                    <div className="flex items-center justify-between">
                      <div className="text-left">
                        <div className="text-3xl mb-2">üíé</div>
                        <div className="font-bold text-xl text-pink-700">Diamond</div>
                        <div className="text-sm text-gray-600">
                          Cost: {starsPerDiamond} ‚≠ê
                        </div>
                      </div>
                      <Gift className="w-12 h-12 text-pink-600" />
                    </div>
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Manage Categories Modal */}
          {showManageCategoriesModal && selectedKid && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-3xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto slide-up">
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-2xl font-bold" style={{ 
                    fontFamily: "'Fredoka', sans-serif",
                    color: selectedKid.color 
                  }}>
                    Manage Categories for {selectedKid.name}
                  </h3>
                  <button
                    onClick={() => setShowManageCategoriesModal(false)}
                    className="p-2 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <X className="w-6 h-6 text-gray-600" />
                  </button>
                </div>

                <p className="text-gray-600 mb-6">
                  Toggle categories on/off. Disabled categories won't appear when tracking stars.
                </p>

                <h4 className="font-bold text-lg mb-3 text-gray-700">Built-in Categories</h4>
                <div className="space-y-3 mb-6">
                  {DEFAULT_CATEGORIES
                    .filter(cat => cat.forKid === 'all' || cat.forKid === selectedKid.id)
                    .map(category => {
                      const isEnabled = isCategoryEnabledForKid(category.id, selectedKid.id);
                      
                      return (
                        <button
                          key={category.id}
                          onClick={() => toggleCategoryForKid(category.id, selectedKid.id)}
                          className="w-full p-4 rounded-2xl border-2 transition-all flex items-center justify-between"
                          style={{
                            background: isEnabled 
                              ? `linear-gradient(135deg, ${category.color}20, ${category.color}40)`
                              : '#f8f9fa',
                            borderColor: isEnabled ? category.color : '#e5e7eb'
                          }}
                        >
                          <div className="flex items-center gap-3">
                            <div className="text-3xl">{category.emoji}</div>
                            <div className="text-left">
                              <div className="font-semibold text-lg">{category.name}</div>
                              <div className="text-sm text-gray-600">
                                {isEnabled ? 'Enabled' : 'Disabled'}
                              </div>
                            </div>
                          </div>
                          
                          <div className={`w-14 h-8 rounded-full transition-all ${
                            isEnabled ? 'bg-green-500' : 'bg-gray-300'
                          } relative`}>
                            <div className={`absolute top-1 w-6 h-6 rounded-full bg-white transition-all ${
                              isEnabled ? 'right-1' : 'left-1'
                            }`} />
                          </div>
                        </button>
                      );
                    })}
                </div>

                {/* Custom Categories Section */}
                {categories.filter(cat => 
                  !DEFAULT_CATEGORIES.some(def => def.id === cat.id) && 
                  (cat.forKid === 'all' || cat.forKid === selectedKid.id)
                ).length > 0 && (
                  <>
                    <h4 className="font-bold text-lg mb-3 text-gray-700">Custom Categories</h4>
                    <div className="space-y-3">
                      {categories
                        .filter(cat => 
                          !DEFAULT_CATEGORIES.some(def => def.id === cat.id) && 
                          (cat.forKid === 'all' || cat.forKid === selectedKid.id)
                        )
                        .map(category => (
                          <div
                            key={category.id}
                            className="w-full p-4 rounded-2xl border-2 transition-all flex items-center justify-between"
                            style={{
                              background: `linear-gradient(135deg, ${category.color}20, ${category.color}40)`,
                              borderColor: category.color
                            }}
                          >
                            <div className="flex items-center gap-3">
                              <div className="text-3xl">{category.emoji}</div>
                              <div className="text-left">
                                <div className="font-semibold text-lg">{category.name}</div>
                                <div className="text-sm text-gray-600">
                                  {category.forKid === 'all' ? 'For both kids' : 'Kid-specific'}
                                </div>
                              </div>
                            </div>
                            
                            <button
                              onClick={() => deleteCategory(category.id)}
                              className="p-2 bg-red-500 hover:bg-red-600 rounded-xl transition-colors"
                            >
                              <Trash className="w-5 h-5 text-white" />
                            </button>
                          </div>
                        ))}
                    </div>
                  </>
                )}

                <div className="mt-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-2xl">
                  <p className="text-sm text-blue-800">
                    üí° Tip: You can also add custom categories for special occasions when clicking on a date!
                  </p>
                </div>
              </div>
            </div>
          )}

          {/* Edit Kid Modal */}
          {showEditKidModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-3xl p-6 max-w-md w-full slide-up">
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-2xl font-bold" style={{ 
                    fontFamily: "'Fredoka', sans-serif",
                    color: editingKid?.color 
                  }}>
                    Edit Kid Profile
                  </h3>
                  <button
                    onClick={() => {
                      setShowEditKidModal(false);
                      setEditingKid(null);
                    }}
                    className="p-2 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <X className="w-6 h-6 text-gray-600" />
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      Name
                    </label>
                    <input
                      type="text"
                      value={editKidName}
                      onChange={(e) => setEditKidName(e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-2xl focus:border-purple-500 focus:outline-none text-lg"
                      placeholder="Kid's name"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      Avatar (emoji)
                    </label>
                    <div className="flex gap-3">
                      {['üëß', 'üë¶', 'üßí', 'üë∂', 'üßë', 'üòä', 'üåü', '‚≠ê'].map(emoji => (
                        <button
                          key={emoji}
                          onClick={() => setEditKidAvatar(emoji)}
                          className={`text-4xl p-3 rounded-2xl transition-all ${
                            editKidAvatar === emoji 
                              ? 'bg-purple-100 scale-110' 
                              : 'bg-gray-100 hover:bg-gray-200'
                          }`}
                        >
                          {emoji}
                        </button>
                      ))}
                    </div>
                  </div>

                  <button
                    onClick={saveKidEdit}
                    className="w-full py-3 rounded-2xl text-white font-bold text-lg transition-all hover:scale-105"
                    style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}
                  >
                    Save Changes
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function App() {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
          setUser(user);
          setLoading(false);
        });
        return unsubscribe;
      }, []);

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center" style={{
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
          }}>
            <div className="text-white text-2xl font-bold">Loading...</div>
          </div>
        );
      }

      return user ? <StarTracker user={user} /> : <LoginScreen />;
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
